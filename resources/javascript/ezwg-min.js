var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,b,a){c instanceof String&&(c=String(c));for(var d=c.length,e=0;e<d;e++){var f=c[e];if(b.call(a,f,e,c))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,b,a){c!=Array.prototype&&c!=Object.prototype&&(c[b]=a.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,b,a,d){if(b){a=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var e=c[d];e in a||(a[e]={});a=a[e]}c=c[c.length-1];d=a[c];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(a,c,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");
function CCarrousel(c,b){var a=this;this.properties=c;this.html=b;this.html.photoClass="mainPhoto";this.html.$viewport=$("#photoViewport");this.html.$slides=$(".slide");this.html.$deprecated="NULL";this.html.$previous=$("#previousSlide");this.html.$next=$("#nextSlide");this.photoDisplayedLoadedEvent=new CEvent;this.scrollingEvent=new CEvent;this.scrolledEvent=new CEvent;this.loader=new CPhotoLoader(c,this.html);this.frameFactory=new CFrameFactory(c.photos.list);this.nextPhoto=this.currPhoto=this.prevPhoto=
-1;this.displayPhoto=function(d,b){TOOLS.trace("CCarrousel::displayPhoto - photo: "+d+"$slide: "+b);b=b.find(a.frameFactory.getStrPhoto());b.find("img").remove();var c=d.getImage();$image=$(c);1==d.isLoaded()&&$image.removeClass().addClass(a.html.photoClass);b.append(c);b.width($image.outerWidth()).height($image.outerHeight());b.parent().width(b.outerWidth()).height(b.outerHeight()+b.siblings().outerHeight()).verticalCenter(0)};this.centerViewport=function(){TOOLS.trace("CCarrousel::centerViewport");
a.html.$viewport.scrollLeft(a.html.$current.position().left)};this.previous=function(b){TOOLS.trace("CCarrousel::previousnew id: "+b);a.setCurrentPhoto(b);var d=a.loader.load(a.currPhoto,a.loader.PREVIOUS);a.currentPhoto=d;a.frameFactory.frame(a.html.$previous,b-1);a.displayPhoto(d,a.html.$previous);a.scroll(a.html.$previous);TOOLS.trace("CCarrousel::previous");return d};this.load=function(b){TOOLS.trace("CCarrousel::load - id: "+b);a.setCurrentPhoto(b);var d=a.loader.load(b,a.loader.NEXT);a.displayPhoto(d,
a.html.$current);a.frameFactory.caption(a.html.$caption,b-1);a.html.$viewport.scrollLeft(a.html.$current.position().left);return a.currentPhoto=d};this.next=function(b){TOOLS.trace("CCarrousel::next - new id: "+b);a.setCurrentPhoto(b);var d=a.loader.load(a.currPhoto,a.loader.NEXT);a.currentPhoto=d;a.frameFactory.frame(a.html.$next,b-1);a.displayPhoto(d,a.html.$next);a.scroll(a.html.$next);return d};this.getCurrentPhoto=function(){TOOLS.trace("CCarrousel::getCurrentPhoto");return a.currentPhoto};this.setSpace=
function(b){TOOLS.trace(NaN-b);a.loader.setSpace(b)};this.updateHandles=function(){TOOLS.trace("CCarrousel::updateHandles");a.html.$deprecated=$(".deprecated");a.html.$previous=$("#previousSlide");a.html.$current=$("#currentSlide");a.html.$next=$("#nextSlide");a.html.$frame=a.html.$current.find(a.frameFactory.getStrFrame());a.html.$div=a.html.$frame.find(a.frameFactory.getStrPhoto());a.html.$caption=a.html.$frame.find(a.frameFactory.getStrCaption());a.html.$slides=$(".slide")};this.setCurrentPhoto=
function(b){TOOLS.trace("CCarrousel::setCurrentPhoto - id: "+b);a.currPhoto=b;a.prevPhoto=b-1;a.nextPhoto=b+1};this.scroll=function(b){TOOLS.trace("CCarrousel::scroll - $target: "+b);a.scrollingEvent.fire();a.html.$frame.addClass("deprecated");b==a.html.$previous?($("#slidesContainer").animate({left:"+="+a.html.$current.outerWidth()+"px"},"fast","swing",function(){window.setTimeout(function(){a.onScrolled("BACKWARD")},20)}),a.html.$next.addClass("deprecated"),a.html.$current.attr("id","nextSlide"),
a.html.$previous.attr("id","currentSlide")):($("#slidesContainer").animate({left:"-="+a.html.$current.outerWidth()+"px"},"fast","swing",function(){window.setTimeout(function(){a.onScrolled("FORWARD")},20)}),a.html.$previous.addClass("deprecated"),a.html.$current.attr("id","previousSlide"),a.html.$next.attr("id","currentSlide"));a.updateHandles()};this.onPhotoLoaded=function(){TOOLS.trace("CCarrousel::onPhotoLoaded");this.id==a.currPhoto&&(a.displayPhoto(this,a.html.$current),a.photoDisplayedLoadedEvent.fire(this))};
this.loader.getPhotoLoadedEvent().subscribe(a.onPhotoLoaded);this.onScrolled=function(b){TOOLS.trace("CCarrousel::onScrolled - erase $deprecated: "+a.html.$deprecated);a.html.$deprecated.remove();"FORWARD"==b?($("#slidesContainer").css("left","0px"),a.html.$current.parent().append('<div id="nextSlide" class="slide"></div>')):(a.html.$current.parent().prepend('<div id="previousSlide" class="slide"></div>'),$("#slidesContainer").css("left","0px"));a.updateHandles();a.scrolledEvent.fire()};this.getPhotoDisplayedLoadedEvent=
function(){return a.photoDisplayedLoadedEvent};this.getScrollingEvent=function(){return a.scrollingEvent};this.getScrolledEvent=function(){return a.scrolledEvent}};function CDisplay(c,b,a){var d=this;this.html=b;this.html.photo.spinnerSrc="resources/images/ajax-loader.gif";this.properties=c;this.carrousel=new CCarrousel(c,this.html.photo);this.navBars=new CNavBars(b);this.url=new CUrl(c.photos.list);this.idCurrentPhoto=-1;this.photoScreenEvent=new CEvent;this.indexScreenEvent=new CEvent;this.disableUISignal=new CEvent;this.enableUISignal=new CEvent;this.displayedPhotoLoadedEvent=new CEvent;this.availableSpace={h:0,w:0};$(".display_optional").hide();this.deck=
new CDeck;this.toolbar=Toolbar(b,a);d.deck.moveOnTop(d.toolbar.screenIndex);d.toolbar.screenPhoto.eventOnHiding.subscribe(function(){d.hidePhoto()});$(window).resize(function(){d.setSpace(d.computeAvailableSpace());!0===d.html.photo.$screen.is(":visible")&&(d.fitPhoto(d.carrousel.getCurrentPhoto()),d.carrousel.centerViewport())});this.displayCurrentUrl=function(){TOOLS.trace("CDisplay::displayCurrentUrl");d.url.display(d.displayPhoto)};this.displayPhoto=function(a){TOOLS.trace("CDisplay::displayPhoto - id: "+
a);d.idCurrentPhoto=a;d.toolbar.screenPhoto.display();d.html.photo.buttons.$next.verticalCenter(d.computeToolbarTopHeigth()/2);d.html.photo.buttons.$previous.css("top",d.html.photo.buttons.$next.css("top"));d.setSpace(d.computeAvailableSpace());d.load(a,d.carrousel.load);d.photoScreenEvent.fire()};this.hidePhoto=function(){TOOLS.trace("CDisplay::hidePhoto");var a=d.html.index.mosaic.$thumbBoxes.eq(d.idCurrentPhoto-1);d.indexScreenEvent.fire(a)};this.getPhotoDisplayedLoadedEvent=function(){return d.displayedPhotoLoadedEvent};
this.getPhotoScreenEvent=function(){return d.photoScreenEvent};this.getIndexScreenEvent=function(){return d.indexScreenEvent};this.getDisableUISignal=function(){return d.disableUISignal};this.getEnableUISignal=function(){return d.enableUISignal};this.getScrollingEvent=function(){return d.carrousel.getScrollingEvent()};this.getScrolledEvent=function(){return d.carrousel.getScrolledEvent()};this.onPrevious=function(){d.idCurrentPhoto--;d.load(d.idCurrentPhoto,d.carrousel.previous)};this.onNext=function(){d.idCurrentPhoto++;
d.load(d.idCurrentPhoto,d.carrousel.next)};this.onPhotoDisplayedLoaded=function(){d.displayedPhotoLoadedEvent.fire(this);d.fitPhoto(this)};d.carrousel.getPhotoDisplayedLoadedEvent().subscribe(this.onPhotoDisplayedLoaded);this.setSpace=function(a){TOOLS.trace("CDisplay::setSpace - space: "+a);var b={};b.h=a.h-d.computeToolbarTopHeigth();b.w=a.w;d.availableSpace=b;d.carrousel.setSpace(b)};this.load=function(a,b){TOOLS.trace("CDisplay::load - id: "+a);d.disableUISignal.fire();a=b(a);1==a.isLoaded()&&
d.displayedPhotoLoadedEvent.fire(a);d.fitPhoto(a)};this.computeAvailableSpace=function(){var a=parseInt(d.html.photo.$frame.css("padding-top").replace("px","")),b=2*$(".photoCaption").css("padding-bottom").replace("px","")+$(".photoCaption").innerHeight();b=d.html.photo.$wrapper.innerHeight()-2*a-2*d.properties.photos.technical.decoration.padding-b;a=d.html.photo.$wrapper.innerWidth()-0-2*a-2*d.properties.photos.technical.decoration.padding;return{h:b,w:a}};this.fitPhoto=function(a){var b=a.nativeSize.h/
a.nativeSize.w,c={};1<b?(c.h=d.availableSpace.h,c.w=Math.round(c.h/b),c.w>d.availableSpace.w&&(c.w=d.availableSpace.w,c.h=Math.round(c.w*b))):(c.w=d.availableSpace.w,c.h=Math.round(c.w*b),c.h>d.availableSpace.h&&(c.h=d.availableSpace.h,c.w=Math.round(c.h/b)));b=d.computeToolbarTopHeigth()/2;a.resize(c);d.html.photo.$div.width(a.size.w+2*d.properties.photos.technical.decoration.padding).height(a.size.h+2*d.properties.photos.technical.decoration.padding);d.html.photo.$frame.width(d.html.photo.$div.outerWidth()).height(d.html.photo.$div.outerHeight()+
d.html.photo.$caption.outerHeight()).css("position","relative").verticalCenter(b);a.verticalCenter(0)};this.computeToolbarTopHeigth=function(){var a=$(".toolbar").filter(":visible").outerHeight();a>$(document).height()/2&&(a=0);return a}};function CEvent(){this.subscribers=[];CEvent.prototype.subscribe=function(c){void 0!=c&&-1==this.subscribers.indexOf(c)&&this.subscribers.push(c)};CEvent.prototype.unsubscribe=function(c){for(var b in this.subscribers)if(this.subscribers[b]==c){this.subscribers.splice(b,1);break}};CEvent.prototype.fire=function(c){for(var b=0;b<this.subscribers.length;b++)this.subscribers[b].call(c)}};function CFifo(){var c=this;this.m_stack=[];this.m_length=0;this.push=function(b){c.m_stack[c.m_length]=b;c.m_length++};this.pushFirst=function(b){for(var a=c.m_length;0<a;a--)c.m_stack[a]=c.m_stack[a-1];c.m_stack[0]=b;c.m_length++};this.pop=function(){if(0<c.m_length){var b=c.m_stack.shift();c.m_length--}else b="undefined";return b};this.size=function(){return c.m_length}};function CFrameFactory(c){var b=this;this.strPhoto="divPhoto";this.strFrame="cadrePhoto";this.strCaption="photoCaption";this.paddingCaption="0";this.captions=[];for(i=0;i<c.length;i++)this.captions[i]=c[i].caption;this.frame=function(a,d){a.append('<div id="'+b.strFrame+'"><div id="'+b.strTitle+'"></div><div id="'+b.strPhoto+'"></div><div class="'+b.strCaption+'"></div></div>');b.caption(a.find(b.getStrCaption()),d)};this.caption=function(a,d){a.empty().append(b.captions[d]);""===b.captions[d]?a.css("padding-top",
"0").css("padding-bottom","0"):a.css("padding-top",b.paddingCaption).css("padding-bottom",b.paddingCaption)};this.getStrPhoto=function(){return"#"+b.strPhoto};this.getStrFrame=function(){return"#"+b.strFrame};this.getStrCaption=function(){return"."+b.strCaption};this.paddingCaption=0===$(".photoCaption").length?0:$(this.getStrCaption()).css("padding-bottom")};function CHashTable(){var c=this;this.len=0;this.items=[];for(var b=0;b<arguments.length;b+=2)"undefined"!=typeof arguments[b+1]&&(c.items[arguments[b]]=arguments[b+1],c.len++);this.removeItem=function(a){"undefined"!=typeof c.items[a]&&(c.len--,c.items.splice(a,1))};this.addItem=function(a,b){return"undefined"!=typeof b&&"undefined"==typeof c.items[a]?(c.len++,c.items[a]=b):"undefined"};this.getItem=function(a){return c.items[a]};this.hasItem=function(a){return"undefined"!=typeof c.items[a]};this.getLength=
function(){return c.len}};function CMosaic(c,b){this.buildHtml=function(){a.htmlStructure.index.mosaic.$handle.hide();for(var b=1;b<=a.mosaicNbThumbnails;b++)a.htmlStructure.index.mosaic.$handle.append('<div class="thumbBox" id="'+b+'"></div>');b=$(".thumbBox");a.htmlStructure.index.mosaic.$thumbBoxes=b;a.thumbnailsSet=a.computeThumbnailsSet();b.each(function(b){b=a.properties.photos.list[b].filename;var d=new Image;$(this).append(d);$(d).load(function(){a.oneThumbLoadedEvent.fire(this)}).attr("id",this.id).attr("src",src=
a.properties.defines.URL_THUMBS_PATH+"/"+a.thumbnailsSet+"/"+b)});return a.htmlStructure};this.onThumbnailLoaded=function(){++a.nbThumbnailLoaded==a.mosaicNbThumbnails&&a.allThumbsLoadedEvent.fire()};this.onThumbnailsLoaded=function(){a.htmlStructure.index.mosaic.$thumbnails=a.htmlStructure.index.mosaic.$thumbBoxes.find("img");var b=a.htmlStructure.index.mosaic.$thumbBoxes,c=a.htmlStructure.index.mosaic.$thumbnails;a.htmlStructure.index.mosaic.$handle.show();a.htmlStructure.index.mosaic.$handle.width("95%");
b.css("box-sizing","border-box");b.css("width",1/a.properties.index.mosaic.nbCols*100+"%");a.ratioThumbboxeBorders=b.eq(0).css("border-left-width").replace("px","")/a.htmlStructure.index.mosaic.$handle.width();a.ratioThumbnailBorders=c.eq(0).css("border-left-width").replace("px","")/a.htmlStructure.index.mosaic.$handle.width();a.redraw()};this.show=function(b){a.htmlStructure.index.mosaic.$thumbnails.verticalCenter(0);"undefined"!=typeof b&&a.center(b)};this.hide=function(){a.htmlStructure.index.mosaic.$handle.hide()};
this.center=function(b){var d=a.htmlStructure.index.mosaic.$thumbBoxes.eq(0);b=b.offset().top-d.offset().top;a.htmlStructure.index.mosaic.$wrapper.scrollTop(b)};this.getLoadingEvent=function(){return a.oneThumbLoadedEvent};this.getLoadedEvent=function(){return a.allThumbsLoadedEvent};this.computeThumbnailsSet=function(){var b=a.properties.index.mosaic.defaultSet,c=a.htmlStructure.index.mosaic.$wrapper.innerWidth(),f=Number.MAX_VALUE;$.each(a.properties.index.mosaic.sizes,function(d,e){e=c-a.properties.index.mosaic.nbCols*
(e+2*a.properties.index.mosaic.decoration.borderBox+2*a.properties.index.mosaic.decoration.borderPhoto);0<e&&e<f&&(f=e,b=d)});return b};this.redraw=function(){var b=a.htmlStructure.index.mosaic.$thumbBoxes,c=a.htmlStructure.index.mosaic.$thumbnails;width=b.eq(0).width();b.css("height",width+"px");c.css("max-width","100%");c.css("max-height","100%");var f=a.ratioThumbboxeBorders*a.htmlStructure.index.mosaic.$handle.width();b.css("border-left-width",f+"px").css("border-top-width",f+"px").css("border-right-width",
f+"px").css("border-bottom-width",f+"px");f=a.ratioThumbnailBorders*a.htmlStructure.index.mosaic.$handle.width();c.css("border-left-width",f+"px").css("border-top-width",f+"px").css("border-right-width",f+"px").css("border-bottom-width",f+"px");f=Math.ceil(a.mosaicNbThumbnails/a.properties.index.mosaic.nbCols);for(var g=0,r=0,m=a.mosaicNbThumbnails,l=0,n=0;n<f;++n){for(var k=0,p=Math.min(a.properties.index.mosaic.nbCols,m),h=0;h<p;++h){var q=c.eq(g++).height();k<q&&(k=q);--m}for(h=0;h<p;++h)b.eq(r++).css("height",
k+"px");l+=k}c.verticalCenter(0);l+=a.htmlStructure.index.mosaic.$title.outerHeight(!0)+50;a.htmlStructure.index.mosaic.$handle.height(l)};var a=this;this.properties=c;this.htmlStructure=b;this.mosaicNbThumbnails=a.properties.photos.list.length;this.ratioThumbnailBorders=this.ratioThumbboxeBorders=this.nbThumbnailLoaded=0;this.oneThumbLoadedEvent=new CEvent;this.oneThumbLoadedEvent.subscribe(this.onThumbnailLoaded);this.allThumbsLoadedEvent=new CEvent;this.allThumbsLoadedEvent.subscribe(this.onThumbnailsLoaded)}
;function CNavBars(c){var b=this;this.html=c;this.html.photo.buttons.$nav=$.merge($(".photoButtonEnabled"),$(".photoButtonDisabled"));setTimeout(function(){b.hide()},250);$("#photoViewport").mousemove(function(){clearTimeout(b.timer);b.show();b.timer=setTimeout(function(){b.hide()},250)});b.html.photo.buttons.$nav.mouseenter(function(){clearTimeout(b.timer)});this.show=function(){b.html.photo.$navBars.fadeIn(10).css("z-index","50");b.html.photo.buttons.$nav.verticalCenter(0)};this.hide=function(){b.html.photo.$navBars.stop().fadeOut(1E3,
function(){$(this).css("z-index","-10")})}};function CPhoto(c,b){var a=this;this.nativeSize=b;this.size=TOOLS.clone(b);this.id=c;this.f_loaded=!1;this.spinner=new Image;this.spinner.src="resources/images/ajax-loader.gif";this.image=new Image;CPhoto.prototype.load=function(b,c){0==this.f_loaded&&$(this.image).load(function(){TOOLS.trace("CPhoto::prototype::load - "+this.src+" loaded.");a.f_loaded=!0;c(a)}).attr("src",b)};CPhoto.prototype.resize=function(a){var b=TOOLS.clone(this.nativeSize);a.w<this.nativeSize.w&&a.h<this.nativeSize.h&&(b=a);
1==this.f_loaded&&$(this.image).width(b.w).height(b.h);this.size=b};CPhoto.prototype.verticalCenter=function(a){$(this.getImage()).css("position","relative").verticalCenter(a)};CPhoto.prototype.getImage=function(){return 1==this.f_loaded?this.image:this.spinner};CPhoto.prototype.isLoaded=function(){return this.f_loaded}};function CPhotoLoader(c,b){var a=this;this.NEXT=1;this.PREVIOUS=-1;this.properties=c;this.html=b;this.strategy=new CPhotoStrategy(c);this.$spinner=$(new Image);this.$spinner.attr("src",this.html.spinnerSrc);this.storage=new CStorage(c.photos.technical.cacheSize);this.prefetchingQueue=new CFifo;this.photoLoadedEvent=new CEvent;this.fetch=function(b){TOOLS.trace("CPhotoLoader::fetch - Fetching "+b);b=a.strategy.getImage(b);var c=a.storage.addPhoto(b);0==c.isLoaded()?c.load(b.url,function(b){a.photoLoadedEvent.fire(b);
0<a.prefetchingQueue.size()&&a.fetch(a.prefetchingQueue.pop())}):0<a.prefetchingQueue.size()&&a.fetch(a.prefetchingQueue.pop());return c};this.load=function(b,c){for(var d=a.properties.photos.technical.prefetchSize;0<d;d--){var e=b+c*d;e<=a.properties.photos.list.length&&0<e&&a.prefetchingQueue.pushFirst(e)}return a.fetch(b)};this.setSpace=function(b){a.strategy.setSpace(b)};this.getPhotoLoadedEvent=function(){return a.photoLoadedEvent}};function CPhotoStrategy(c){var b=this;this.properties=c;this.getDppx=function(){var a=1;if(!navigator.userAgent.match(/(Phone)|(Mobile)/i)||navigator.userAgent.match(/(iPad)|(iPod)/i))a=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth)||1;return a};this.getImage=function(a){var c=b.getImageStrategyFct(a);c.id=a;TOOLS.trace("CPhotoStrategy::getImage - space: "+b.spaceRealPx.w+" "+b.spaceRealPx.h+" / "+c.url);return c};this.setSpace=function(a){b.spaceRealPx.h=
a.h*b.spaceRealPx.dppx;b.spaceRealPx.w=a.w*b.spaceRealPx.dppx};this.getBiggerImage=function(a){var c=b.properties.photos.list[a-1].sizes,e={};$.each(c,function(a,c){Math.max(c.width,c.height)>=Math.max(b.spaceRealPx.w,b.spaceRealPx.h)&&(e[a]=c)});var f=Number.MAX_VALUE,g=b.properties.photos.technical.largetSet;$.each(e,function(a,b){b.width<f&&(f=e[a].width,g=a)});return{url:b.properties.defines.IMAGES_PATH+"/"+g+"/"+b.properties.photos.list[a-1].filename,size:{w:c[g].width,h:c[g].height}}};this.getSmallerImage=
function(a){var c=b.properties.photos.list[a-1].sizes,e={};$.each(c,function(a,c){c.width<=b.spaceRealPx.w&&c.height<=b.spaceRealPx.h&&(e[a]=c)});var f=0,g=b.properties.photos.technical.smallestSet;$.each(e,function(a,b){b.width>f&&(f=e[a].width,g=a)});return{url:b.properties.defines.IMAGES_PATH+"/"+g+"/"+b.properties.photos.list[a-1].filename,size:{w:c[g].width,h:c[g].height}}};this.getImageStrategyStr={0:b.getBiggerImage,1:b.getSmallerImage};this.getImageStrategyFct=this.getImageStrategyStr[this.properties.photos.technical.qualityStrategy];
this.spaceRealPx={h:0,w:0,dppx:this.getDppx()}};CProgressBar=function(c){var b=this;this.options=c;this.nbThumbnailsLoaded=0;CProgressBar.prototype.onLoad=function(){b.nbThumbnailsLoaded++;b.options.$progessBar.reportprogress(b.nbThumbnailsLoaded,b.options.nbThumbnails)};CProgressBar.prototype.show=function(){b.options.$screen.show();b.options.$progessBar.parent().verticalCenter(0)};CProgressBar.prototype.hide=function(){b.options.$screen.hide()}};function CDeck(){var c=this;this.storage=[];this.add=function(b){c.storage.push(b)};this.getTop=function(){return c.storage[c.storage.length-1]};this.moveOnTop=function(b){b=c.storage.indexOf(b);if(-1!==b){var a=c.storage.length-1;oldScrTop=c.storage[a];c.storage[a]=c.storage[b];c.storage[b]=oldScrTop}};this.removeFromTop=function(){if(1<c.storage){var b=c.storage.length-1;oldScrTop=c.storage[b];c.storage[b]=c.storage[b-1];c.storage[b-1]=oldScrTop}}}
function CScreen(c){var b=this;b.$handle=c.$handle;b.deck=c.deck;b.listButtonsOther=c.listButtonsOther;b.buttonScreen=c.buttonScreen;this.eventOnDisplaying=new CEvent;this.eventOnDisplayed=new CEvent;this.eventOnHiding=new CEvent;this.eventOnHidden=new CEvent;this.display=function(){"undefined"!==b.buttonScreen&&b.buttonScreen.disable();b.$handle.css("z-index","100").fadeIn("fast",function(){for(var a=0;a<b.listButtonsOther.length;a++)"undefined"!==typeof b.listButtonsOther[a]&&b.listButtonsOther[a].enable();
scr=b.deck.getTop();scr.hide();b.deck.moveOnTop(b);b.eventOnDisplayed.fire()});b.eventOnDisplaying.fire()};this.hide=function(){b.eventOnHiding.fire();b.$handle.css("z-index","-1").hide();b.eventOnHidden.fire()}}
function CButtonToolbar(c){var b=this;b.$handle=c.$handle;b.onClick=c.onClick;b.onLoaded=c.onLoaded;"undefined"!==typeof c.script&&-1!=c.script.indexOf("//")?(b.script=c.script,b.isLocked=!0):(b.script="undefined",b.isLocked=!1);this.enable=function(){b.isLocked||b.$handle.css("opacity","1").css("cursor","pointer").unbind().click(b.onClick)};this.disable=function(){b.$handle.css("opacity","0.4").css("cursor","not-allowed").unbind()};"undefined"!=b.script&&$.getScript(b.script,function(){b.isLocked=
!1;b.enable()});b.$handle.show();this.enable()};CScroller=function(c){this.options=c;var b=this;this.options.$navigation.css("cursor","pointer").click(function(){var a=$(this).attr("target");a=b.options.$viewport.find(a);b.scrollTo($(this),a)});CScroller.prototype.scrollTo=function(a,c){b.options.$viewport.animate({scrollLeft:c.position().left},b.options.duration,b.options.easing,function(){b.options.onAfter(a,c)})};CScroller.prototype.scrollToPageNr=function(a,c){a=b.options.$navigation.eq(a-1);c=b.options.$navigation.eq(c-1).attr("target");c=
b.options.$viewport.find(c);b.scrollTo(a,c)}};function CStorage(c){var b=this;this.nbItems=c;this.storage=new CHashTable;this.ages=[];for(var a=0;a<this.nbItems;a++)this.ages[a]=-1;this.addPhoto=function(a){0==b.storage.hasItem(a.url)&&(b.removeOldest(),b.storage.addItem(a.url,new CPhoto(a.id,a.size)),b.updateAges(a.url));TOOLS.trace("CStorage::addPhoto - Cache free space: "+(b.nbItems-b.storage.getLength()));return b.storage.getItem(a.url)};this.removeOldest=function(){if(b.storage.getLength()>=b.nbItems){var a=b.ages[b.nbItems-1];b.storage.removeItem(a);
TOOLS.trace("CStorage::removeOldest - removing "+a)}};this.updateAges=function(c){for(a=b.nbItems-1;0<a;a--)b.ages[a]=b.ages[a-1];b.ages[0]=c};this.photoLoaded=function(a){b.storage.getItem(a).isLoaded=!0}};function CUrl(c){var b=this;this.photoStr="Photo";this.photoList=c;this.setHash=function(a){window.location.hash=b.photoStr+a};this.clearHash=function(){window.location.hash=""};this.display=function(a){var c=window.location.hash;c=parseInt(c.substring(c.indexOf(b.photoStr)+b.photoStr.length));!isNaN(parseInt(c))&&isFinite(c)&&c<=b.photoList.length&&a(c)}};function CUserInterractions(c,b){var a=this;this.html=b;this.properties=c;this.windowResizedEvent=new CEvent;this.thumbnailClickedEvent=new CEvent;this.closePhotoEvent=new CEvent;this.previousPhotoEvent=new CEvent;this.previousPhotoEvent=new CEvent;this.nextPhotoEvent=new CEvent;this.buttonEnabledClass="photoButtonEnabled";this.buttonDisabledClass="photoButtonDisabled";this.previousPhotoId=-1;this.currentPhotoId=1;this.nextPhotoId=2;this.watchedKeyDown=this.fEnablePreviousNextRequired=this.fCurrentlyScrolling=
!1;this.start=function(){$(window).resize(function(){a.onWindowResized()});a.enableThumbnailClick();a.disablePreviousNext();a.properties.photos.technical.rightClickEnabled||a.html.photo.$screen.bind("contextmenu",function(a){return!1})};this.disablePreviousNext=function(){a.disablePrevious();a.disableNext()};this.enablePreviousNext=function(){if(a.fCurrentlyScrolling)TOOLS.trace("CUserInterractions::enablePreviousNext - scrolling -> defered"),a.fEnablePreviousNextRequired=!0;else{TOOLS.trace("CUserInterractions::enablePreviousNext - not scrolling -> immediate");
a.enablePrevious();a.enableNext();a.fEnablePreviousNextRequired=!1;var b=a.html.photo.$current.data("hammer");b.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL});b.get("doubletap").set({enable:!1});b.get("pan").set({enable:!1});b.get("press").set({enable:!1})}};this.enablePrevious=function(){1<=a.previousPhotoId&&(TOOLS.trace("CUserInterractions::enablePrevious - enable previous "+a.previousPhotoId),a.html.photo.buttons.$previous.removeClass().addClass(a.buttonEnabledClass).one("click",a.onPreviousPhoto),
a.html.photo.$current.hammer().bind("swiperight",function(b){a.onPreviousPhoto()}))};this.disablePrevious=function(){TOOLS.trace("CUserInterractions::disablePrevious - disable previous");a.html.photo.buttons.$previous.removeClass().addClass(a.buttonDisabledClass).unbind("click");a.html.photo.$current.hammer().unbind("swiperight")};this.enableNext=function(){a.nextPhotoId<=a.properties.photos.list.length&&(TOOLS.trace("CUserInterractions::enableNext - enable next "+a.nextPhotoId),a.html.photo.buttons.$next.removeClass().addClass(a.buttonEnabledClass).one("click",
a.onNextPhoto),a.html.photo.$current.hammer().bind("swipeleft",function(b){a.onNextPhoto()}))};this.disableNext=function(){TOOLS.trace("CUserInterractions::disableNext - disable next");a.html.photo.buttons.$next.removeClass().addClass(a.buttonDisabledClass).unbind("click");a.html.photo.$current.hammer().unbind("swipeleft")};this.enableThumbnailClick=function(){a.html.index.mosaic.$thumbnails.click(function(){TOOLS.trace("CUserInterractions::enableThumbnailClick - thumbnail #"+this.id+" clicked.");
a.thumbnailClickedEvent.fire(this)})};this.getWindowResizedEvent=function(){return a.windowResizedEvent};this.getThumbnailClickedEvent=function(){return a.thumbnailClickedEvent};this.getPreviousPhotoEvent=function(){return a.previousPhotoEvent};this.getNextPhotoEvent=function(){return a.nextPhotoEvent};this.onWindowResized=function(){a.windowResizedEvent.fire()};this.onPhotoDisplayedLoaded=function(b){a.previousPhotoId=b-1;a.nextPhotoId=b+1;a.currentPhotoId=b;window.setTimeout(function(){a.enablePreviousNext()},
20)};this.onPreviousPhoto=function(){a.disablePrevious();a.previousPhotoEvent.fire({id:a.previousPhotoId})};this.onNextPhoto=function(){a.disableNext();a.nextPhotoEvent.fire({id:a.nextPhotoId})};this.onScrolling=function(){a.fCurrentlyScrolling=!0};this.onScrolled=function(){TOOLS.trace("CUserInterractions::onScrolled - "+a.fEnablePreviousNextRequired);a.fCurrentlyScrolling=!1;a.fEnablePreviousNextRequired&&(a.fEnablePreviousNextRequired=!1,a.enablePreviousNext())};this.onIndexScreen=function(){$(window).unbind("keydown");
a.html.photo.$screen.css("z-index",1);a.html.index.$screen.css("z-index",10);a.enableThumbnailClick()};this.onPhotoScreen=function(){$(window).unbind("keydown").keydown(function(b){a.onKeyboardPhotoScr(b)});a.html.index.mosaic.$thumbnails.unbind("click");a.html.index.$screen.css("z-index",1);a.html.photo.$screen.css("z-index",10)};this.onKeyboardPhotoScr=function(b){if(0==a.watchedKeyDown)switch(b.keyCode||b.which){case 37:a.watchedKeyDown=!0;a.html.photo.buttons.$previous.click();a.watchedKeyDown=
!1;break;case 39:a.watchedKeyDown=!0;a.html.photo.buttons.$next.click();a.watchedKeyDown=!1;break;case 27:a.watchedKeyDown=!0,a.html.toolbar.$buttonIndex.click(),a.watchedKeyDown=!1}}};Defines={URL_THUMBS_PATH:"thumbnails",IMAGES_PATH:"images"};TOOLS={trace:function(c){window.console&&console.log((new Date).getTime()+": "+c)},clone:function(c){var b={};jQuery.extend(b,c);return b},debug:function(c){$("#DEBUG").append(c).show()}};jQuery.fn.verticalCenter=function(c){return this.each(function(){var b=jQuery(this),a=b.parent();b.is(":visible")&&a.is(":visible")?(a=(a.innerHeight()-b.outerHeight())/2-c,a=Math.max(a,0),b.css("top",a)):TOOLS.trace("Vertical center: object or its parent not visible!")})};
jQuery.fn.fit=function(c){return this.each(function(){var b=jQuery(this),a=b.width()/b.height();b.width(c).height(c/a)})};$(document).ajaxError(function(){TOOLS.trace("Error ajax: "+$(this).attr("src"))});
$(document).ready(function(){g_properties.defines=Defines;HtmlStructure={$window:$(window),progressBar:{$screen:$("#screenProgress"),$box:$("#progressbarWrapper"),$bar:$("#progressbar")},toolbar:{$buttonFullscreen:$(".button_screen"),$buttonShare:$(".button_share"),$buttonIndex:$(".button_browse")},share:{$screen:$("#screenShare"),$wrapper:$("#wrapper_share"),$buttons:$(".addtoany_button")},index:{$screen:$("#screenIndex"),mosaic:{$wrapper:$("#wrapper_mosaic"),$handle:$("#mosaic"),$title:$("#indexTitle")}},
photo:{$screen:$("#screenPhoto"),$current:$("#currentSlide"),$frame:$("#cadrePhoto"),$wrapper:$("#wrapperAffichagePhoto"),$div:$("#divPhoto"),$caption:$(".photoCaption"),$navBars:$.merge($("#photoLefter"),$("#photoRighter")),buttons:{$previous:$("#boutonPrevious"),$next:$("#boutonNext"),$close:$("#screenPhoto").find(".button_browse")}}};HtmlStructure.index.$screen.find(".button_browse").css("opacity","0.4").css("filter","alpha(opacity=40)");Mosaic=new CMosaic(g_properties,HtmlStructure);progressBar=
new CProgressBar({$screen:$("#screenPogress"),$progessBar:HtmlStructure.progressBar.$bar,nbThumbnails:g_properties.photos.list.length});Mosaic.getLoadingEvent().subscribe(progressBar.onLoad);Mosaic.getLoadedEvent().subscribe(function(){progressBar.hide();Mosaic.show();Mosaic.getLoadingEvent().unsubscribe(progressBar.onLoad());HtmlStructure.progressBar.$screen.remove();delete HtmlStructure.progressBar.$screen});var c,b;Mosaic.getLoadedEvent().subscribe(function(){c=new CUserInterractions(g_properties,
HtmlStructure);c.start();b=new CDisplay(g_properties,HtmlStructure,c);b.getPhotoDisplayedLoadedEvent().subscribe(function(){c.onPhotoDisplayedLoaded(this.id)});b.getPhotoScreenEvent().subscribe(c.onPhotoScreen);b.getIndexScreenEvent().subscribe(function(){Mosaic.show(this);Mosaic.redraw()});b.getDisableUISignal().subscribe(c.disablePreviousNext);b.getEnableUISignal().subscribe(c.enablePreviousNext);b.getScrollingEvent().subscribe(c.onScrolling);b.getScrolledEvent().subscribe(c.onScrolled);b.toolbar.showButtons();
c.getWindowResizedEvent().subscribe(function(){Mosaic.redraw()});c.getThumbnailClickedEvent().subscribe(function(){b.displayPhoto(parseInt(this.id))});c.getPreviousPhotoEvent().subscribe(b.onPrevious);c.getNextPhotoEvent().subscribe(b.onNext);b.displayCurrentUrl()});progressBar.show();HtmlStructure=Mosaic.buildHtml()});
